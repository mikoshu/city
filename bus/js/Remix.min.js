(function(){var t=[].slice,e=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},n=function(t,e){function n(){this.constructor=t}for(var r in e)i.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t},i={}.hasOwnProperty;!function(t){"function"==typeof define&&null!=define.amd?define(["jquery"],t):"object"==typeof exports?module.exports=t(require("jquery")):this.Remix=t("undefined"==typeof jQuery?Zepto:jQuery)}(function(r){var o,s,u,l,a,p,c;return s={bind:function(t,e){var n,i,r,o,s;for(i=t.split(" "),this.hasOwnProperty("_callbacks")||this._callbacks||(this._callbacks={}),r=0,o=i.length;o>r;r++)s=i[r],(n=this._callbacks)[s]||(n[s]=[]),this._callbacks[s].push(e);return this},one:function(t,e){var n;return this.bind(t,n=function(){return this.unbind(t,n),e.apply(this,arguments)})},trigger:function(){var e,n,i,r,o,s,u;if(e=1<=arguments.length?t.call(arguments,0):[],i=e.shift(),s=null!=(u=this._callbacks)?u[i]:void 0){for(r=0,o=s.length;o>r&&(n=s[r],n.apply(this,e)!==!1);r++);return!0}},unbind:function(t,e){var n,i,r,o,s,u,l,a,p,c;if(0===arguments.length)return this._callbacks={},this;if(!t)return this;for(i=t.split(" "),o=0,u=i.length;u>o;o++)if(p=i[o],a=null!=(c=this._callbacks)?c[p]:void 0)if(e){for(r=s=0,l=a.length;l>s;r=++s)if(n=a[r],n===e){a=a.slice(),a.splice(r,1),this._callbacks[p]=a;break}}else delete this._callbacks[p];return this}},s.on=s.bind,s.off=s.unbind,l={trace:!0,logPrefix:"(Remix)",log:function(){var e;return e=1<=arguments.length?t.call(arguments,0):[],this.trace?(this.logPrefix&&e.unshift(this.logPrefix),"undefined"!=typeof console&&null!==console&&"function"==typeof console.log&&console.log.apply(console,e),this):void 0}},c=["included","extended"],a=function(){function t(){"function"==typeof this.init&&this.init.apply(this,arguments)}return t.include=function(t){var n,i,r;if(!t)throw new Error("include(obj) requires obj");for(n in t)r=t[n],e.call(c,n)<0&&(this.prototype[n]=r);return null!=(i=t.included)&&i.apply(this),this},t.extend=function(t){var n,i,r;if(!t)throw new Error("extend(obj) requires obj");for(n in t)r=t[n],e.call(c,n)<0&&(this[n]=r);return null!=(i=t.extended)&&i.apply(this),this},t.proxy=function(t){return function(e){return function(){return t.apply(e,arguments)}}(this)},t.prototype.proxy=function(t){return function(e){return function(){return t.apply(e,arguments)}}(this)},t}(),r.parseHTML=r.parseHTML||function(t){return t},o=function(e){function o(t,e){var n;if(this.parent=t,e)this.node=r(e);else if(this.constructor.noTemplate)throw"No template component must created with node";this._is_lazy_load=!(this.constructor.templateNode||this.constructor.noTemplate||this.constructor===o),this.child_components={},this.state=this._getInitialState(),this.refs={},this.childs={},this._initialRender=!0,this._parseRemixChild(),this._parseNode(),n=function(t){return function(){return t._runMixinMethod("initialize"),t.initialize()}}(this),this._is_lazy_load?this.constructor.one("template-loaded",function(t){return function(){return t._parseNode(),n()}}(this)):n()}return n(o,e),o.include(s),o.extend(s),o.loadTemplate=function(t){var e,n;return null==t?void(this.noTemplate=!0):"string"==typeof t?~t.indexOf("<")?(t=r.trim(t),this.templateNode=r(r.parseHTML(t))):~t.indexOf("/")?(n=r.get(t),n.done(function(t){return function(e){return t.templateNode=r(r.parseHTML(e))}}(this)),e=function(t){return function(){return t.templateNode=r(r.parseHTML("<span>Error loading template: "+templateStr+" </span>"))}}(this),n.fail(e),n.complete(function(t){return function(){return t.trigger("template-loaded")}}(this))):this.templateNode=r(t):this.templateNode=r(t)},o.prototype.initialize=function(){},o.prototype.getInitialState=function(){},o.prototype.onNodeCreated=function(){},o.prototype.onTransclude=function(){},o.prototype.addChild=function(t,e){return this[t]=e.setParent(this)},o.prototype.setState=function(t){return this._optimistRender(t)},o.prototype.render=function(){return this.trigger("updated"),this.node},o.prototype.appendTo=function(t){return this.node.appendTo(t),this},o.prototype.nodeTrigger=function(){return this.node.trigger.apply(this.node,arguments)},o.prototype.delegateTo=function(t){return this.parent._delChildComp(this.constructor,this.key),t._regChildComp(this,this.constructor,this.key),this.parent=t,this.creator=this.creator.setParent(t),this},o.prototype.delegate=function(t){return t.delegateTo(this)},o.prototype.append=function(t,e){return null==e&&(e=this.node),"function"==typeof t?(t=t(),e.append(t.node?t.node:t),"function"==typeof t.delegateTo&&t.delegateTo(this)):t instanceof o?(e.append(t.node),t.delegateTo(this)):e.append(t),t},o.prototype.include=function(t,e){return null!=e&&"function"==typeof e.empty&&e.empty(),t=this.append.apply(this,arguments),setTimeout(this.proxy(this._clearComps),0),t},o.prototype.empty=function(){return this.node.empty()},o.prototype.destroy=function(t){var e,n,r,o,s;this._runMixinMethod("onDestroy"),"function"==typeof this.onDestroy&&this.onDestroy(),t||this.node.remove(),s=this.child_components;for(e in s)if(i.call(s,e)){o=s[e];for(r in o)i.call(o,r)&&(n=o[r],n.destroy(!0))}return this.off(),this.node.off(),this.parent._delChildComp(this.constructor,this.key)},o.prototype._getInitialState=function(){var t,e,n,i,o,s;if(s={},n=this._runMixinMethod("getInitialState"),r.isArray(n))for(i=this._runMixinMethod("getInitialState"),t=0,e=i.length;e>t;t++)o=i[t],r.extend(s,o);return r.extend(s,this.getInitialState()),s},o.prototype._optimistRender=function(t){var e;return"object"==typeof t?r.extend(this.state,t):this.state=t,e=function(e){return function(){return e._initialRender&&("function"==typeof e.initialRender&&e.initialRender(t),e._initialRender=!1),e._runMixinMethod("render",t),e.render(t),setTimeout(e.proxy(e._clearComps),0)}}(this),this._is_lazy_load?this.constructor.one("template-loaded",e):e(),this.node},o.prototype._getChildComp=function(t,e){var n,i;return null!=(n=this.child_components)&&null!=(i=n[t.$id])?i[e]:void 0},o.prototype._getAllChildComp=function(t){var e,n,i,r,o,s,u,l,a;if(t){u=null!=(s=this.child_components)?s[t.$id]:void 0,a=[];for(r in u)n=u[r],a.push(n);return a}e=[],l=this.child_components;for(i in l){o=l[i];for(r in o)n=o[r],e.push(n)}return e},o.prototype._clearComps=function(){var t,e,n,i;for(i=this._getAllChildComp(),e=0,n=i.length;n>e;e++)t=i[e],t._preserve||r.contains(document.documentElement,t.node[0])||t.destroy();return null},o.prototype._regChildComp=function(t,e,n){var i,r,o;if(r=(i=this.child_components)[o=e.$id]||(i[o]={}),null!=r[n])throw"child component already exist!";return r[n]=t,t},o.prototype._delChildComp=function(t,e){var n,i;return null!=(n=this.child_components)&&null!=(i=n[t.$id])?delete i[e]:void 0},o.prototype._parseRemixChild=function(){var t,e,n,i;if(this.remixChild&&"object"==typeof this.remixChild){n=this.remixChild,i=[];for(e in n)t=n[e],i.push(this.addChild(e,t));return i}},o.prototype._parseNode=function(){var t,e;return t=function(t){return function(e){return t._parseRefs(),t._runMixinMethod("onTransclude",e),t.onTransclude(e),t._parseRemix(),t._parseEvents(),t._runMixinMethod("onNodeCreated",e),t.onNodeCreated(e)}}(this),this.constructor.noTemplate?void t():(e=this.node,this.constructor.templateNode?(this.node=this.constructor.templateNode.clone(),e&&e.replaceWith(this.node),t(e)):(this.node=r(r.parseHTML('<span class="loading">loading..</span>')),e?e.replaceWith(this.node):void 0))},o.prototype._parseRefs=function(){var t,e;return t=this.node.find("[ref]"),e=this.node.find("[remix]"),e.length&&(t=t.not(e.find("[ref]"))),t.each(function(t){return function(e,n){var i;return i=r(n),t.refs[i.attr("ref")]=i}}(this))},o.prototype._parseRemix=function(){var t;return t=function(t){return function(e){var n,i,o,s,u,l,a,c,h,d,f;n=r(e);try{d=n.data(),d=r.extend({},d)}catch(l){throw u=l,"This build of Zepto does not support data() -> object"}for(a in d)f=d[a],f+="",0===f.indexOf("@")&&(c=f.substring(1),d[a]=null!=t[c]?t.proxy(t[c]):function(e){return function(){if(t[e])return t[e]();throw e+" does not exist"}}(c));if(o=n.attr("remix"),i=t[o],null==i){if(null==p[o])throw'Remixing child "'+o+'" does not exist';i=t.addChild(o,p[o])}return s=function(e){var i;return i=n.attr("ref"),i?(t.refs[i]=e.node,t.childs[i]=e):void 0},h=i(d,n.attr("key"),e,s)}}(this),this.node.find("[remix]").not(this.node.find("[remix] [remix]")).each(function(){return t(this)})},o.prototype._parseEvents=function(){var t,e,n,i,o,s,u,l,a,p;if(this.remixEvent&&"object"==typeof this.remixEvent){s=this.remixEvent,a=[];for(t in s){if(i=s[t],u=t.split(","),e=u[0],p=u[1],l=u[2],e=r.trim(e),null!=p&&(p=r.trim(p),null==l?(l=p,p=null):l=r.trim(l)),n=function(t){return function(e){return function(n){var i;if(i=t[e],null==i)throw"handler "+e+" not found";return null!=i?i.call(t,n,r(n.currentTarget)):void 0}}}(this)(i),o=l?"@"===l?this.node:this.refs[l]:this.node,null==o)throw"Event's referencing node \""+l+'" does not exist';a.push(p?o.on(e,p,n):o.on(e,n))}return a}return"function"==typeof this.remixEvent?(this.remixEvent=this.remixEvent(),this._parseEvents()):void 0},o.prototype._runMixinMethod=function(){var e,n,i,o,s,u,l,a;if(s=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],r.isArray(this.mixins)){for(u=this.mixins,a=[],n=0,i=u.length;i>n;n++)o=u[n],a.push(null!=(l=o[s])&&"function"==typeof l.apply?l.apply(this,e):void 0);return a}},o}(a),u=new o,p=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return n(e,t),e.include(s),e.id_counter=1,e.create=function(t,s){var l,a,p,c,h,d,f,m,y;for(null==s&&(s=t,t=null),r.isArray(s.mixins)||(s.mixins=null!=s.mixins?[s.mixins]:[]),f=s.mixins,p=0,h=f.length;h>p;p++){d=f[p];for(c in d)i.call(d,c)&&(y=d[c],null==o.prototype[c]&&null==s[c]&&(s[c]=y))}return l=function(t){function i(){return i.__super__.constructor.apply(this,arguments)}return n(i,t),i.include(s),i.loadTemplate(s.template),i.$id=e.id_counter++,i}(o),m=function(t){var n;return n=function(e,i,o,s){var u;return o=r(o).get(0),i||(i="$default"),u=t._getChildComp(l,i),u||(u=new l(t,o),u.creator=n,u.key=i,t._regChildComp(u,l,i)),"function"==typeof s&&s(u),u._optimistRender(e),u},n.setParent=m,n.bindNode=function(t,e){return n({},e,t)},n.get=function(e){return e||(e="$default"),t._getChildComp(l,e)},n.getAll=function(){return t._getAllChildComp(l)},n.destroyAll=function(){return r.each(n.getAll(),function(t,e){return e.destroy()})},n.extend=function(t,n){return n||(n=t,t=null),n=r.extend({},s,n),e.create(t,n)},n},a=m(u),t&&(e[t]=a),a},e}(a)})}).call(this);